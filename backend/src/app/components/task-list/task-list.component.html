<div class="task-list-container">

  <!-- HEADER -->
  <div class="header">
    <div class="header-content">
      <h1>Task Management</h1>

      <div class="header-actions">
        <button (click)="navigateToDashboard()" class="btn-dashboard">Dashboard</button>
        <span class="user-name">{{ authService.currentUser()?.name }}</span>
        <button (click)="logout()" class="btn-logout">Logout</button>
      </div>
    </div>
  </div>

  <div class="container">

    <!-- SEARCH + FILTERS -->
    <div class="controls">
      <div class="search-filter">

        <!-- SEARCH INPUT -->
        <input  
          type="text"
          placeholder="Search tasks..."
          [value]="searchQuery()"
          (input)="searchQuery.set(searchBox.value)"
          #searchBox
          class="search-input"
        />

        <!-- STATUS FILTER -->
        <select
          #statusSel
          [value]="filterStatus()"
          (change)="filterStatus.set(statusSel.value)"
          class="filter-select"
        >
          <option value="All">All Status</option>
          <option value="Pending">Pending</option>
          <option value="In Progress">In Progress</option>
          <option value="Completed">Completed</option>
        </select>

        <!-- PRIORITY FILTER -->
        <select
          #prioritySel
          [value]="filterPriority()"
          (change)="filterPriority.set(prioritySel.value)"
          class="filter-select"
        >
          <option value="All">All Priority</option>
          <option value="Low">Low</option>
          <option value="Medium">Medium</option>
          <option value="High">High</option>
        </select>
      </div>

      <button (click)="openAddForm()" class="btn-add">
        + Add New Task
      </button>
    </div>

    <!-- ADD / EDIT FORM -->
    @if (showForm()) {
      <app-task-form
        [task]="editingTask()"
        (close)="closeForm()">
      </app-task-form>
    }

    <!-- TASK TABLE -->
    <div class="tasks-table">

      @if (filteredTasks.length === 0) {
        <div class="no-tasks">
          <p>No tasks found</p>
        </div>
      } @else {

        <table>
          <thead>
            <tr>
              <th>Title</th>
              <th>Priority</th>
              <th>Status</th>
              <th>Due Date</th>
              <th>Assigned To</th>
              <th>Actions</th>
            </tr>
          </thead>

          <tbody>
            @for (task of filteredTasks; track task.id) {
              <tr>

                <!-- TITLE -->
                <td>
                  <div class="task-title">
                    <strong>{{ task.title }}</strong>
                    @if (task.description) {
                      <small>{{ task.description }}</small>
                    }
                  </div>
                </td>

                <!-- PRIORITY BADGE -->
                <td>
                  <span class="badge" [ngClass]="getPriorityClass(task.priority)">
                    {{ task.priority }}
                  </span>
                </td>

                <!-- STATUS DROPDOWN -->
                <td>
                  <select
                    #status
                    [value]="task.status"
                    (change)="updateStatus(task.id!, status.value)"
                    class="status-select"
                    [ngClass]="getStatusClass(task.status)"
                  >
                    <option value="Pending">Pending</option>
                    <option value="In Progress">In Progress</option>
                    <option value="Completed">Completed</option>
                  </select>
                </td>

                <!-- DUE DATE -->
                <td>
                  @if (task.dueDate) {
                    {{ task.dueDate | date:'MMM dd, yyyy' }}
                  } @else {
                    <span class="no-date">No due date</span>
                  }
                </td>

                <!-- ASSIGNED USER -->
                <td>
                  {{ task.assignedUser?.name || 'Unassigned' }}
                </td>

                <!-- ACTION BUTTONS -->
                <td>
                  <div class="action-buttons">
                    <button
                      (click)="openEditForm(task)"
                      class="btn-edit">‚úèÔ∏è
                    </button>

                    <button
                      (click)="deleteTask(task.id!)"
                      class="btn-delete">üóëÔ∏è
                    </button>
                  </div>
                </td>

              </tr>
            }
          </tbody>
        </table>

      }
    </div>
  </div>
</div>
